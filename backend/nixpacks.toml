[phases.setup]
nixPkgs = ["python311", "python311Packages.pip"]

[phases.install]
cmds = [
    "python3.11 -m pip install --upgrade pip",
    "python3.11 -m pip install -r requirements.txt"
]

[start]
cmd = "bash -c 'source /nix/var/nix/profiles/default/etc/profile.d/nix.sh 2>/dev/null || true; export PATH=\"/nix/store\"*\"\/bin:$PATH\"; PYTHON=\$(which python3.11 2>/dev/null || find /nix/store -name python3.11 -type f 2>/dev/null | head -1); if [ -z \"\$PYTHON\" ]; then PYTHON=python3; fi; exec \"\$PYTHON\" -m uvicorn main:app --host 0.0.0.0 --port \"\${PORT:-8000}\"'"
